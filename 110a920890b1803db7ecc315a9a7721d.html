<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🦜&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>0018 多线程之死锁问题&nbsp;|&nbsp;李正的自留地</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="0018 多线程之死锁问题">
  
    <meta name="description" content="图解多线程死锁形成原因，预防与避免。">
    <meta property="og:description" content="图解多线程死锁形成原因，预防与避免。">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🪶&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🦜&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="e48d9ceebf4c4de2b657c3a3d1d308f4.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;☀️&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>工具</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🎏&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>关于我</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
      <div class="Header__Cover">
        <img src="https://www.notion.so/images/page-cover/solid_red.png">
      </div>
    
    <div class="Header__Spacer ">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🪶&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">0018 多线程之死锁问题</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Sun, Sep 29, 2024</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--gray">
            <a href="tag/JAVA.html">JAVA</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/多线程.html">多线程</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/110a920890b1803db7ecc315a9a7721d" class="PageRoot"><h1 id="https://www.notion.so/111a920890b18071bfaae6f6c0f76c88" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/111a920890b18071bfaae6f6c0f76c88"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">1、死锁场景</span></span></h1><div id="https://www.notion.so/111a920890b180109125d88476d7918d" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">🤪</div></div><p class="Callout__Content"><span class="SemanticStringArray"></span><div id="https://www.notion.so/47f6b777e602490192b216ae187d58ba" class="ColorfulBlock ColorfulBlock--BgGray Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">举例场景：两个憨憨Tom和Sam去西餐厅吃牛排，桌子上只有一把刀和一把叉，Tom先拿到了叉子，Sam拿到了刀。只有同时拿到刀叉才能吃牛排，于是两个憨憨陷入如下的僵局。</span></span></p></div></p></div><div id="https://www.notion.so/111a920890b1801c93f5c8d3211e44a3" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2Fa37640f9-aadc-4bb4-b6f7-76dbbfafb500%2F0018.drawio.png?width=1248&amp;table=block&amp;id=111a9208-90b1-801c-93f5-c8d3211e44a3"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2Fa37640f9-aadc-4bb4-b6f7-76dbbfafb500%2F0018.drawio.png?width=1248&amp;table=block&amp;id=111a9208-90b1-801c-93f5-c8d3211e44a3" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/111a920890b180e6a23dffd96ac88ec3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这个场景中，就存在死锁形成的条件：</span></span></p></div><div id="https://www.notion.so/111a920890b18071949ffd6c9d22572d" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">✍️</div></div><p class="Callout__Content"><span class="SemanticStringArray"></span><div id="https://www.notion.so/7918e3bbff064c19add6f5b47b704ec8" class="ColorfulBlock ColorfulBlock--BgGray Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">互斥条件</strong></span><span class="SemanticString">：一张桌子上只有一把餐刀和一把叉子，且只能由一个人同时使用。Tom和Sam需要同时拿到餐刀和叉子才能吃饭，他们不能共享餐具。餐刀和叉子是资源，它们只能由一个人独占使用，另一个人必须等待餐具的释放。</span></span></p></div></p></div><div id="https://www.notion.so/111a920890b180498306db3bf61466c4" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">✍️</div></div><p class="Callout__Content"><span class="SemanticStringArray"></span><div id="https://www.notion.so/5f1bd0f901e943718d76d78988ff24db" class="ColorfulBlock ColorfulBlock--BgGray Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">请求与保持条件：</strong></span><span class="SemanticString">Sam已经拿到了餐刀，但还在等待拿到叉子；同时，他不会放下已经拿到的餐刀。Tom已经拿到了叉子，但在等待餐刀，也不会先放下叉子。Sam拥有一部分资源（餐刀），并且在等待另一部分资源（叉子），而Tom则持有叉子，等待餐刀。这导致两个人都无法继续用餐</span></span></p></div></p></div><div id="https://www.notion.so/111a920890b1807f82b2f7ce2a601b32" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">✍️</div></div><p class="Callout__Content"><span class="SemanticStringArray"></span><div id="https://www.notion.so/e6d2c7d1fb7745bc9a10c272cb16b838" class="ColorfulBlock ColorfulBlock--BgGray Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">不剥夺条件：</strong></span><span class="SemanticString">一旦一个人拿到了餐刀或叉子，另一个人不能强行夺走它，必须等第一个人自愿放下餐具。</span></span></p></div></p></div><div id="https://www.notion.so/111a920890b1809089a7e084cd177714" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">✍️</div></div><p class="Callout__Content"><span class="SemanticStringArray"></span><div id="https://www.notion.so/870059e8d2ab42a2a8d779f96e1b9d9e" class="ColorfulBlock ColorfulBlock--BgGray Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">循环等待条件：</strong></span><span class="SemanticString">Sam拿着餐刀，等待叉子，而Tom拿着叉子，等待餐刀。这样就形成了一个循环：Tom等待Sam释放资源，Sam等待Tom释放资源，两者都陷入了无限等待的状态。</span></span></p></div></p></div><h1 id="https://www.notion.so/111a920890b180748022d207ececb106" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/111a920890b180748022d207ececb106"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">2、死锁形成的原因</span></span></h1><div id="https://www.notion.so/111a920890b18002b1f8db1b4ed35dd2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">形成死锁有四个必要条件，分别是：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/111a920890b18008823cf0d8e0f7cb1d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">互斥条件（Mutual Exclusion）</strong></span><span class="SemanticString">：资源是独占的，即某个资源一次只能被一个线程持有。如果有其他线程请求资源，就必须等待。</span></span></li><li id="https://www.notion.so/111a920890b180cd9714c9094b460744" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">请求与保持条件（Hold and Wait）</strong></span><span class="SemanticString">：一个线程已经持有了一个资源，并且还在等待获取其他线程持有的资源，而不释放它已占有的资源。</span></span></li><li id="https://www.notion.so/111a920890b180728820f504b9c003bd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">不剥夺条件（No Preemption）</strong></span><span class="SemanticString">：已经获得的资源在未使用完之前不能被强制剥夺，只能由持有该资源的线程主动释放。</span></span></li><li id="https://www.notion.so/111a920890b180d6843ad76cf0ba1d20" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">循环等待条件（Circular Wait）</strong></span><span class="SemanticString">：存在一个线程等待的循环链，每个线程都在等待下一个线程所持有的资源，从而形成了一个闭环。</span></span></li></ul><h1 id="https://www.notion.so/111a920890b180dc8175cccc9e438f4b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/111a920890b180dc8175cccc9e438f4b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3、如何预防死锁</span></span></h1><div id="https://www.notion.so/111a920890b180679d92eee19ae90a90" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">接着看怎么来解决这两个憨憨的吃饭问题。</span></span></p></div><h2 id="https://www.notion.so/111a920890b18038a407e33a3f72a34a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/111a920890b18038a407e33a3f72a34a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3.1 破坏互斥条件</span></span></h2><div id="https://www.notion.so/111a920890b180079413eb93fea2e826" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F7890bd4e-2deb-4a57-b2af-1cf0fa4a0828%2F0018-%25E6%25AD%25BB%25E9%2594%2581%25E9%25A2%2584%25E9%2598%25B2%25E6%25A1%2588%25E4%25BE%258B.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-8007-9413-eb93fea2e826"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F7890bd4e-2deb-4a57-b2af-1cf0fa4a0828%2F0018-%25E6%25AD%25BB%25E9%2594%2581%25E9%25A2%2584%25E9%2598%25B2%25E6%25A1%2588%25E4%25BE%258B.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-8007-9413-eb93fea2e826" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/111a920890b1807e920ac46a0ec8ac25" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第一种避免死锁的方法就是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorBlue"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">破坏互斥条件</strong></mark></span><span class="SemanticString">：通过增加资源的数量（例如多备几套餐具），可以避免资源独占，从而打破互斥条件。现实中，可以通过增加并行资源或共享资源的方式来减少死锁的可能性。</span></span></p></div><div id="https://www.notion.so/111a920890b180aba934f56c95950d4a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/111a920890b1803eb03bc2ad1c31541a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/111a920890b1803eb03bc2ad1c31541a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3.2 破坏请求与保持条件</span></span></h2><div id="https://www.notion.so/111a920890b180fbbdaad21836dcd5a6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F8224cef2-b8a9-412a-b085-8263bc97a634%2F0018-%25E6%25AD%25BB%25E9%2594%2581-%25E7%25A0%25B4%25E5%259D%258F%25E8%25AF%25B7%25E6%25B1%2582%25E4%25B8%258E%25E4%25BF%259D%25E6%258C%2581.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-80fb-bdaa-d21836dcd5a6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F8224cef2-b8a9-412a-b085-8263bc97a634%2F0018-%25E6%25AD%25BB%25E9%2594%2581-%25E7%25A0%25B4%25E5%259D%258F%25E8%25AF%25B7%25E6%25B1%2582%25E4%25B8%258E%25E4%25BF%259D%25E6%258C%2581.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-80fb-bdaa-d21836dcd5a6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/111a920890b180da80dedce683d1b02d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第二种避免死锁的方法就是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorBlue"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">破坏请求与保持条件</strong></mark></span><span class="SemanticString">：规定每个人必须在没有拿任何餐具的时候，先一次性拿好所需的餐刀和叉子。如果他发现没有足够的餐具可用（例如只剩餐刀或叉子），他必须先放下自己手中的餐具，等待下一轮再尝试拿齐。</span></span></p></div><div id="https://www.notion.so/111a920890b180528077ea72bb15f8d5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这种方法避免了“请求与保持”，要求在拥有资源之前确保拿到所有需要的资源。如果无法一次性拿到，必须释放已经持有的资源，这样不会出现资源的相互依赖。</span></span></p></div><div id="https://www.notion.so/111a920890b180c9bb83e3150d132474" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/111a920890b180c49540f3dc176c5c80" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/111a920890b180c49540f3dc176c5c80"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3.3 破坏不剥夺条件</span></span></h2><div id="https://www.notion.so/111a920890b18026888ecf6f006f306b" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F1fad3d13-115f-4972-8d60-d7ee6e546225%2F0018-%25E6%25AD%25BB%25E9%2594%2581-%25E7%25A0%25B4%25E5%259D%258F%25E4%25B8%258D%25E5%2589%25A5%25E5%25A4%25BA%25E6%259D%25A1%25E4%25BB%25B6.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-8026-888e-cf6f006f306b"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F1fad3d13-115f-4972-8d60-d7ee6e546225%2F0018-%25E6%25AD%25BB%25E9%2594%2581-%25E7%25A0%25B4%25E5%259D%258F%25E4%25B8%258D%25E5%2589%25A5%25E5%25A4%25BA%25E6%259D%25A1%25E4%25BB%25B6.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-8026-888e-cf6f006f306b" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/111a920890b180629decd98eba08b26f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第三种预防死锁的方式就是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorBlue"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">破坏不剥夺条件</strong></mark></span><span class="SemanticString">：设定一个规则，如果某个人在拿到餐刀后长时间没有拿到刀，就必须自动放下餐具，以便其他人使用。</span></span></p></div><div id="https://www.notion.so/111a920890b1805abd9fe0680569d743" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这种方式打破了不剥夺条件，使资源能够被强制释放。对于计算机系统，可以通过设置超时机制或者资源预占的方式来避免死锁。例如，当一个线程长时间占有资源而没有完成任务时，可以强制回收资源，让其他线程使用。</span></span></p></div><div id="https://www.notion.so/111a920890b180cdb01ee815c8d2c075" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/111a920890b18058808dd106fa5b7fce" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/111a920890b18058808dd106fa5b7fce"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">3.4 破坏循环等待条件</span></span></h2><div id="https://www.notion.so/111a920890b1804f9e7ccf51dcfa578e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F0c4d8a29-2074-490b-acbb-4fdfae87157a%2F0018-%25E6%25AD%25BB%25E9%2594%2581-%25E7%25A0%25B4%25E5%259D%258F%25E5%25BE%25AA%25E7%258E%25AF%25E7%25AD%2589%25E5%25BE%2585%25E6%259D%25A1%25E4%25BB%25B6.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-804f-9e7c-cf51dcfa578e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F333b4f28-5127-4daf-8c39-ec7700f99e1b%2F0c4d8a29-2074-490b-acbb-4fdfae87157a%2F0018-%25E6%25AD%25BB%25E9%2594%2581-%25E7%25A0%25B4%25E5%259D%258F%25E5%25BE%25AA%25E7%258E%25AF%25E7%25AD%2589%25E5%25BE%2585%25E6%259D%25A1%25E4%25BB%25B6.drawio.png?width=1232.5125732421875&amp;table=block&amp;id=111a9208-90b1-804f-9e7c-cf51dcfa578e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/111a920890b1802b9914e1aa9b6c2dfa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">第四种预防死锁的方式就是</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorBlue"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">破坏循环等待条件</strong></mark></span><span class="SemanticString">：规定用餐时必须按照固定顺序拿餐具，例如每个人必须先拿叉，再拿刀。这样，就不会出现两个人一个拿刀一个拿叉、互相等待的情况。</span></span></p></div><div id="https://www.notion.so/111a920890b180fcab41f98ed0946c29" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过规定资源获取的顺序，可以避免形成环形依赖链。在计算机系统中，也可以通过全局的资源顺序策略，确保线程在请求多个资源时，必须按照固定的顺序请求，从而避免循环等待。</span></span></p></div><div id="https://www.notion.so/111a920890b18051b4a9f9c06f6defdf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h1 id="https://www.notion.so/110a920890b180e08491db2f8a2558a9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/110a920890b180e08491db2f8a2558a9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4、如何避免死锁</span></span></h1><div id="https://www.notion.so/110a920890b1800cbe96ca90ce64f22f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><blockquote id="https://www.notion.so/110a920890b180258203edfc0f5f2954" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedColor SemanticString__Fragment--ColorOrange"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">银行家算法</strong></mark></span><span class="SemanticString">是一种资源分配和死锁避免算法，主要用于确保在多个进程并发运行时系统不会进入不安全状态。以下是其原理和实现的详细介绍。</span></span></blockquote><h3 id="https://www.notion.so/110a920890b18040ba34c006b08ac2ca" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/110a920890b18040ba34c006b08ac2ca"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4.1 原理</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/110a920890b18021883de172ecc09f30" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">安全状态与不安全状态</strong></span><span class="SemanticString">：</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/110a920890b18050a322c1b245e9bb4a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">系统在资源分配时要确保处于安全状态。如果有一种资源分配方式，能够保证所有进程最终都能完成，那么系统就是安全的。</span></span></li><li id="https://www.notion.so/110a920890b1801f8188ff62d224c180" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">如果不能找到这样的分配方式，系统则处于不安全状态。</span></span></li></ul></li><li id="https://www.notion.so/110a920890b180c48cb2f93f9ca5c1b7" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">请求与分配</strong></span><span class="SemanticString">：</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/110a920890b18016b40fc94068a5fb03" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">每个进程在运行时会声明其最大资源需求（最大资源向量）。</span></span></li><li id="https://www.notion.so/110a920890b18082adb7e62c4565fb93" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">进程在执行期间会请求资源。算法会检查这个请求是否会导致系统进入不安全状态。</span></span></li></ul></li><li id="https://www.notion.so/110a920890b180e18810c7f18559b036" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">资源分配步骤</strong></span><span class="SemanticString">：</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/110a920890b1804e878cece2b61f9d8d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">当一个进程请求资源时，算法会进行以下检查：</span></span><ol class="NumberedListWrapper"><li id="https://www.notion.so/110a920890b180558bbdf21cd9f1a4dd" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">检查请求是否小于或等于最大需求。</span></span></li><li id="https://www.notion.so/110a920890b180a3a834cb05389958af" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">检查请求是否小于或等于当前可用资源。</span></span></li><li id="https://www.notion.so/110a920890b180a7b276df6ff52ca7a9" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">假设资源被分配给该进程，检查系统是否依然安全。</span></span></li></ol></li><li id="https://www.notion.so/110a920890b180f58202e7ea2b64bb0e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">如果所有检查都通过，资源将被分配；否则，进程需要等待。</span></span></li></ul></li></ol><h3 id="https://www.notion.so/110a920890b18053bd08e4dcc9dbe895" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/110a920890b18053bd08e4dcc9dbe895"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">4.2 实现</span></span></h3><div id="https://www.notion.so/110a920890b1801088a7fd30924d8f89" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下是一个简单的银行家算法的实现思路：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/110a920890b180149492d9e5f78917ea" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">数据结构</strong></span><span class="SemanticString">：</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/110a920890b180448a4cd5eefef9e49c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">max[][]</code></span><span class="SemanticString">：每个进程的最大需求。</span></span></li><li id="https://www.notion.so/110a920890b18063b212f6e7035583ca" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">allocation[][]</code></span><span class="SemanticString">：当前已分配给每个进程的资源。</span></span></li><li id="https://www.notion.so/110a920890b180f68669cc28464c22a0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">need[][]</code></span><span class="SemanticString">：每个进程还需要的资源，</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">need[i][j] = max[i][j] - allocation[i][j]</code></span><span class="SemanticString">。</span></span></li><li id="https://www.notion.so/110a920890b18032ad9fefe091ad9eb5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">available[]</code></span><span class="SemanticString">：当前可用的资源。</span></span></li></ul></li><li id="https://www.notion.so/110a920890b18018bb9adf0f3b63e74c" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">算法步骤</strong></span><span class="SemanticString">：</span></span><pre id="https://www.notion.so/110a920890b1806b8818c27f8201a38b" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">requestResources</span><span class="token punctuation">(</span><span class="token keyword">int</span> processID<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 检查请求是否有效</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> resources<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> need<span class="token punctuation">[</span>processID<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">||</span> request<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> available<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 请求无效</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2. 假设分配资源</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> resources<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        available<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-=</span> request<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation<span class="token punctuation">[</span>processID<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> request<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        need<span class="token punctuation">[</span>processID<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-=</span> request<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3. 检查系统安全性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 资源分配成功</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 4. 回滚</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> resources<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            available<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> request<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            allocation<span class="token punctuation">[</span>processID<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-=</span> request<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            need<span class="token punctuation">[</span>processID<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> request<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 资源分配失败</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> finish <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span>numProcesses<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> work <span class="token operator">=</span> available<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> numProcesses<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> found <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numProcesses<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>finish<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">canProceed</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> work<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> resources<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    work<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> allocation<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                finish<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                found <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>found<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// 无法找到可以执行的进程</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果所有进程都完成，则安全</span>
    <span class="token keyword">return</span> count <span class="token operator">==</span> numProcesses<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">canProceed</span><span class="token punctuation">(</span><span class="token keyword">int</span> processID<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> work<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> resources<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>need<span class="token punctuation">[</span>processID<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> work<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre></li></ol><div id="https://www.notion.so/111a920890b1808293c4d140d0095475" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/111a920890b18046a8bcf3a5fdef1bff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
  <div>&copy; 李正的自留地 2024</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>

</body>

</html>